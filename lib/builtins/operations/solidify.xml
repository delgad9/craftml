<craft name="solidify">
    <content></content>
    <script>

        function select(solids){
            return _.flatten(_.map(solids, function(solid){
                var selected = []
                if (solid.csg && solid.csg.properties.type == 'lines'){
                    selected.push(solid)
                }
                return selected.concat(select(solid.children))
            }))
        }

        function main(params, scope) {

            var slices = select(scope.solids)//[0].children

            var csg = CSG.fromSlices({
                numslices: slices.length,
                callback: function(x, i) {
                    var solid = slices[i]
                    solid.apply()
                    return solid.csg.polygons[0]
                }
            })

            var solid = new Solid(csg)
            scope.solids = [solid]
        }
    </script>
</craft>
